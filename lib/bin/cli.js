#!/usr/bin/env node
'use strict';

var Liftoff = require('liftoff');
var Promise = require('bluebird');
var interpret = require('interpret');
var path = require('path');
var chalk = require('chalk');
var tildify = require('tildify');
var commander = require('commander');
var cliPkg = require('../../package');
var argv = require('minimist')(process.argv.slice(2));
var fs = Promise.promisifyAll(require('fs'));

function exit(text) {
  if (text instanceof Error) {
    chalk.red(console.error(text.stack));
  } else {
    chalk.red(console.error(text));
  }
  process.exit(1);
}

function success(text) {
  console.log(text);
  process.exit(0);
}

function checkLocalModule(env) {
  if (!env.modulePath) {
    console.log(chalk.red('No local knex install found in:'), chalk.magenta(tildify(env.cwd)));
    exit('Try running: npm install knex.');
  }
}

function initKnex(env) {

  checkLocalModule(env);

  if (!env.configPath) {
    exit('No knexfile found in this directory. Specify a path with --knexfile');
  }

  if (process.cwd() !== env.cwd) {
    process.chdir(env.cwd);
    console.log('Working directory changed to', chalk.magenta(tildify(env.cwd)));
  }

  var environment = commander.env || process.env.NODE_ENV;
  var defaultEnv = 'development';
  var config = require(env.configPath);

  if (!environment && typeof config[defaultEnv] === 'object') {
    environment = defaultEnv;
  }

  if (environment) {
    console.log('Using environment:', chalk.magenta(environment));
    config = config[environment] || config;
  }

  if (!config) {
    console.log(chalk.red('Warning: unable to read knexfile config'));
    process.exit(1);
  }

  if (argv.debug !== undefined) config.debug = argv.debug;
  var knex = require(env.modulePath);
  return knex(config);
}

function invoke(env) {

  var pending,
      filetypes = ['js', 'coffee', 'eg', 'ls'];

  commander.version(chalk.blue('Knex CLI version: ', chalk.green(cliPkg.version)) + '\n' + chalk.blue('Local Knex version: ', chalk.green(env.modulePackage.version)) + '\n').option('--debug', 'Run with debugging.').option('--knexfile [path]', 'Specify the knexfile path.').option('--cwd [path]', 'Specify the working directory.').option('--env [name]', 'environment, default: process.env.NODE_ENV || development');

  commander.command('init').description('        Create a fresh knexfile.').option('-x [' + filetypes.join('|') + ']', 'Specify the knexfile extension (default js)').action(function () {
    var type = (argv.x || 'js').toLowerCase();
    if (filetypes.indexOf(type) === -1) {
      exit('Invalid filetype specified: ' + type);
    }
    if (env.configPath) {
      exit('Error: ' + env.configPath + ' already exists');
    }
    checkLocalModule(env);
    var stubPath = './knexfile.' + type;
    pending = fs.readFileAsync(path.dirname(env.modulePath) + '/lib/migrate/stub/knexfile-' + type + '.stub').then(function (code) {
      return fs.writeFileAsync(stubPath, code);
    }).then(function () {
      success(chalk.green('Created ' + stubPath));
    })['catch'](exit);
  });

  commander.command('migrate:make <name>').description('       Create a named migration file.').option('-x [' + filetypes.join('|') + ']', 'Specify the stub extension (default js)').action(function (name) {
    var ext = (argv.x || env.configPath.split('.').pop()).toLowerCase();
    pending = initKnex(env).migrate.make(name, { extension: ext }).then(function (name) {
      success(chalk.green('Created Migration: ' + name));
    })['catch'](exit);
  });

  commander.command('migrate:latest').description('        Run all migrations that have not yet been run.').action(function () {
    pending = initKnex(env).migrate.latest().spread(function (batchNo, log) {
      if (log.length === 0) {
        success(chalk.cyan('Already up to date'));
      }
      success(chalk.green('Batch ' + batchNo + ' run: ' + log.length + ' migrations \n' + chalk.cyan(log.join('\n'))));
    })['catch'](exit);
  });

  commander.command('migrate:rollback').description('        Rollback the last set of migrations performed.').action(function () {
    pending = initKnex(env).migrate.rollback().spread(function (batchNo, log) {
      if (log.length === 0) {
        success(chalk.cyan('Already at the base migration'));
      }
      success(chalk.green('Batch ' + batchNo + ' rolled back: ' + log.length + ' migrations \n') + chalk.cyan(log.join('\n')));
    })['catch'](exit);
  });

  commander.command('migrate:currentVersion').description('       View the current version for the migration.').action(function () {
    pending = initKnex(env).migrate.currentVersion().then(function (version) {
      success(chalk.green('Current Version: ') + chalk.blue(version));
    })['catch'](exit);
  });

  commander.command('seed:make <name>').description('       Create a named seed file.').option('-x [' + filetypes.join('|') + ']', 'Specify the stub extension (default js)').action(function (name) {
    var ext = (argv.x || env.configPath.split('.').pop()).toLowerCase();
    pending = initKnex(env).seed.make(name, { extension: ext }).then(function (name) {
      success(chalk.green('Created seed file: ' + name));
    })['catch'](exit);
  });

  commander.command('seed:run').description('       Run seed files.').action(function () {
    pending = initKnex(env).seed.run().spread(function (log) {
      if (log.length === 0) {
        success(chalk.cyan('No seed files exist'));
      }
      success(chalk.green('Ran ' + log.length + ' seed files \n' + chalk.cyan(log.join('\n'))));
    })['catch'](exit);
  });

  commander.parse(process.argv);

  Promise.resolve(pending).then(function () {
    commander.help();
  });
}

var cli = new Liftoff({
  name: 'knex',
  extensions: interpret.jsVariants,
  v8flags: require('v8flags')
});

cli.on('require', function (name) {
  console.log('Requiring external module', chalk.magenta(name));
});

cli.on('requireFail', function (name) {
  console.log(chalk.red('Failed to load external module'), chalk.magenta(name));
});

cli.launch({
  cwd: argv.cwd,
  configPath: argv.knexfile,
  require: argv.require,
  completion: argv.completion
}, invoke);
//# sourceMappingURL=data:application/json;base64,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QUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Q0FDL0UsQ0FBQyxDQUFDOztBQUVILEdBQUcsQ0FBQyxNQUFNLENBQUM7QUFDVCxLQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUc7QUFDYixZQUFVLEVBQUUsSUFBSSxDQUFDLFFBQVE7QUFDekIsU0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO0FBQ3JCLFlBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtDQUM1QixFQUFFLE1BQU0sQ0FBQyxDQUFDIiwiZmlsZSI6ImNsaS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG5cbnZhciBMaWZ0b2ZmICAgPSByZXF1aXJlKCdsaWZ0b2ZmJyk7XG52YXIgUHJvbWlzZSAgID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbnZhciBpbnRlcnByZXQgPSByZXF1aXJlKCdpbnRlcnByZXQnKTtcbnZhciBwYXRoICAgICAgPSByZXF1aXJlKCdwYXRoJyk7XG52YXIgY2hhbGsgICAgID0gcmVxdWlyZSgnY2hhbGsnKTtcbnZhciB0aWxkaWZ5ICAgPSByZXF1aXJlKCd0aWxkaWZ5Jyk7XG52YXIgY29tbWFuZGVyID0gcmVxdWlyZSgnY29tbWFuZGVyJyk7XG52YXIgY2xpUGtnICAgID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZScpO1xudmFyIGFyZ3YgICAgICA9IHJlcXVpcmUoJ21pbmltaXN0JykocHJvY2Vzcy5hcmd2LnNsaWNlKDIpKTtcbnZhciBmcyAgICAgICAgPSBQcm9taXNlLnByb21pc2lmeUFsbChyZXF1aXJlKCdmcycpKTtcblxuZnVuY3Rpb24gZXhpdCh0ZXh0KSB7XG4gIGlmICh0ZXh0IGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBjaGFsay5yZWQoY29uc29sZS5lcnJvcih0ZXh0LnN0YWNrKSk7XG4gIH0gZWxzZSB7XG4gICAgY2hhbGsucmVkKGNvbnNvbGUuZXJyb3IodGV4dCkpO1xuICB9XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn1cblxuZnVuY3Rpb24gc3VjY2Vzcyh0ZXh0KSB7XG4gIGNvbnNvbGUubG9nKHRleHQpO1xuICBwcm9jZXNzLmV4aXQoMCk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrTG9jYWxNb2R1bGUoZW52KSB7XG4gIGlmICghZW52Lm1vZHVsZVBhdGgpIHtcbiAgICBjb25zb2xlLmxvZyhjaGFsay5yZWQoJ05vIGxvY2FsIGtuZXggaW5zdGFsbCBmb3VuZCBpbjonKSwgY2hhbGsubWFnZW50YSh0aWxkaWZ5KGVudi5jd2QpKSk7XG4gICAgZXhpdCgnVHJ5IHJ1bm5pbmc6IG5wbSBpbnN0YWxsIGtuZXguJyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW5pdEtuZXgoZW52KSB7XG5cbiAgY2hlY2tMb2NhbE1vZHVsZShlbnYpO1xuXG4gIGlmICghZW52LmNvbmZpZ1BhdGgpIHtcbiAgICBleGl0KCdObyBrbmV4ZmlsZSBmb3VuZCBpbiB0aGlzIGRpcmVjdG9yeS4gU3BlY2lmeSBhIHBhdGggd2l0aCAtLWtuZXhmaWxlJyk7XG4gIH1cblxuICBpZiAocHJvY2Vzcy5jd2QoKSAhPT0gZW52LmN3ZCkge1xuICAgIHByb2Nlc3MuY2hkaXIoZW52LmN3ZCk7XG4gICAgY29uc29sZS5sb2coJ1dvcmtpbmcgZGlyZWN0b3J5IGNoYW5nZWQgdG8nLCBjaGFsay5tYWdlbnRhKHRpbGRpZnkoZW52LmN3ZCkpKTtcbiAgfVxuXG4gIHZhciBlbnZpcm9ubWVudCA9IGNvbW1hbmRlci5lbnYgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlY7XG4gIHZhciBkZWZhdWx0RW52ICA9ICdkZXZlbG9wbWVudCc7XG4gIHZhciBjb25maWcgICAgICA9IHJlcXVpcmUoZW52LmNvbmZpZ1BhdGgpO1xuXG4gIGlmICghZW52aXJvbm1lbnQgJiYgdHlwZW9mIGNvbmZpZ1tkZWZhdWx0RW52XSA9PT0gJ29iamVjdCcpIHtcbiAgICBlbnZpcm9ubWVudCA9IGRlZmF1bHRFbnY7XG4gIH1cblxuICBpZiAoZW52aXJvbm1lbnQpIHtcbiAgICBjb25zb2xlLmxvZygnVXNpbmcgZW52aXJvbm1lbnQ6JywgY2hhbGsubWFnZW50YShlbnZpcm9ubWVudCkpO1xuICAgIGNvbmZpZyA9IGNvbmZpZ1tlbnZpcm9ubWVudF0gfHwgY29uZmlnO1xuICB9XG5cbiAgaWYgKCFjb25maWcpIHtcbiAgICBjb25zb2xlLmxvZyhjaGFsay5yZWQoJ1dhcm5pbmc6IHVuYWJsZSB0byByZWFkIGtuZXhmaWxlIGNvbmZpZycpKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cblxuICBpZiAoYXJndi5kZWJ1ZyAhPT0gdW5kZWZpbmVkKVxuICAgIGNvbmZpZy5kZWJ1ZyA9IGFyZ3YuZGVidWc7XG4gIHZhciBrbmV4ID0gcmVxdWlyZShlbnYubW9kdWxlUGF0aCk7XG4gIHJldHVybiBrbmV4KGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIGludm9rZShlbnYpIHtcblxuICB2YXIgcGVuZGluZywgZmlsZXR5cGVzID0gWydqcycsICdjb2ZmZWUnLCAnZWcnLCAnbHMnXTtcblxuICBjb21tYW5kZXJcbiAgICAudmVyc2lvbihcbiAgICAgIGNoYWxrLmJsdWUoJ0tuZXggQ0xJIHZlcnNpb246ICcsIGNoYWxrLmdyZWVuKGNsaVBrZy52ZXJzaW9uKSkgKyAnXFxuJyArXG4gICAgICBjaGFsay5ibHVlKCdMb2NhbCBLbmV4IHZlcnNpb246ICcsIGNoYWxrLmdyZWVuKGVudi5tb2R1bGVQYWNrYWdlLnZlcnNpb24pKSArICdcXG4nXG4gICAgKVxuICAgIC5vcHRpb24oJy0tZGVidWcnLCAnUnVuIHdpdGggZGVidWdnaW5nLicpXG4gICAgLm9wdGlvbignLS1rbmV4ZmlsZSBbcGF0aF0nLCAnU3BlY2lmeSB0aGUga25leGZpbGUgcGF0aC4nKVxuICAgIC5vcHRpb24oJy0tY3dkIFtwYXRoXScsICdTcGVjaWZ5IHRoZSB3b3JraW5nIGRpcmVjdG9yeS4nKVxuICAgIC5vcHRpb24oJy0tZW52IFtuYW1lXScsICdlbnZpcm9ubWVudCwgZGVmYXVsdDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgZGV2ZWxvcG1lbnQnKTtcblxuXG4gIGNvbW1hbmRlclxuICAgIC5jb21tYW5kKCdpbml0JylcbiAgICAuZGVzY3JpcHRpb24oJyAgICAgICAgQ3JlYXRlIGEgZnJlc2gga25leGZpbGUuJylcbiAgICAub3B0aW9uKCcteCBbJyArIGZpbGV0eXBlcy5qb2luKCd8JykgKyAnXScsICdTcGVjaWZ5IHRoZSBrbmV4ZmlsZSBleHRlbnNpb24gKGRlZmF1bHQganMpJylcbiAgICAuYWN0aW9uKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHR5cGUgPSAoYXJndi54IHx8ICdqcycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBpZiAoZmlsZXR5cGVzLmluZGV4T2YodHlwZSkgPT09IC0xKSB7XG4gICAgICAgIGV4aXQoJ0ludmFsaWQgZmlsZXR5cGUgc3BlY2lmaWVkOiAnICsgdHlwZSk7XG4gICAgICB9XG4gICAgICBpZiAoZW52LmNvbmZpZ1BhdGgpIHtcbiAgICAgICAgZXhpdCgnRXJyb3I6ICcgKyBlbnYuY29uZmlnUGF0aCArICcgYWxyZWFkeSBleGlzdHMnKTtcbiAgICAgIH1cbiAgICAgIGNoZWNrTG9jYWxNb2R1bGUoZW52KTtcbiAgICAgIHZhciBzdHViUGF0aCA9ICcuL2tuZXhmaWxlLicgKyB0eXBlO1xuICAgICAgcGVuZGluZyA9IGZzLnJlYWRGaWxlQXN5bmMocGF0aC5kaXJuYW1lKGVudi5tb2R1bGVQYXRoKSArICcvbGliL21pZ3JhdGUvc3R1Yi9rbmV4ZmlsZS0nICsgdHlwZSArICcuc3R1YicpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvZGUpIHtcbiAgICAgICAgICByZXR1cm4gZnMud3JpdGVGaWxlQXN5bmMoc3R1YlBhdGgsIGNvZGUpO1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHN1Y2Nlc3MoY2hhbGsuZ3JlZW4oJ0NyZWF0ZWQgJyArIHN0dWJQYXRoKSk7XG4gICAgICAgIH0pLmNhdGNoKGV4aXQpO1xuICAgIH0pO1xuXG4gIGNvbW1hbmRlclxuICAgIC5jb21tYW5kKCdtaWdyYXRlOm1ha2UgPG5hbWU+JylcbiAgICAuZGVzY3JpcHRpb24oJyAgICAgICBDcmVhdGUgYSBuYW1lZCBtaWdyYXRpb24gZmlsZS4nKVxuICAgIC5vcHRpb24oJy14IFsnICsgZmlsZXR5cGVzLmpvaW4oJ3wnKSArICddJywgJ1NwZWNpZnkgdGhlIHN0dWIgZXh0ZW5zaW9uIChkZWZhdWx0IGpzKScpXG4gICAgLmFjdGlvbihmdW5jdGlvbihuYW1lKSB7XG4gICAgICB2YXIgZXh0ID0gKGFyZ3YueCB8fCBlbnYuY29uZmlnUGF0aC5zcGxpdCgnLicpLnBvcCgpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgcGVuZGluZyA9IGluaXRLbmV4KGVudikubWlncmF0ZS5tYWtlKG5hbWUsIHtleHRlbnNpb246IGV4dH0pLnRoZW4oZnVuY3Rpb24obmFtZSkge1xuICAgICAgICBzdWNjZXNzKGNoYWxrLmdyZWVuKCdDcmVhdGVkIE1pZ3JhdGlvbjogJyArIG5hbWUpKTtcbiAgICAgIH0pLmNhdGNoKGV4aXQpO1xuICAgIH0pO1xuXG4gIGNvbW1hbmRlclxuICAgIC5jb21tYW5kKCdtaWdyYXRlOmxhdGVzdCcpXG4gICAgLmRlc2NyaXB0aW9uKCcgICAgICAgIFJ1biBhbGwgbWlncmF0aW9ucyB0aGF0IGhhdmUgbm90IHlldCBiZWVuIHJ1bi4nKVxuICAgIC5hY3Rpb24oZnVuY3Rpb24oKSB7XG4gICAgICBwZW5kaW5nID0gaW5pdEtuZXgoZW52KS5taWdyYXRlLmxhdGVzdCgpLnNwcmVhZChmdW5jdGlvbihiYXRjaE5vLCBsb2cpIHtcbiAgICAgICAgaWYgKGxvZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBzdWNjZXNzKGNoYWxrLmN5YW4oJ0FscmVhZHkgdXAgdG8gZGF0ZScpKTtcbiAgICAgICAgfVxuICAgICAgICBzdWNjZXNzKGNoYWxrLmdyZWVuKCdCYXRjaCAnICsgYmF0Y2hObyArICcgcnVuOiAnICsgbG9nLmxlbmd0aCArICcgbWlncmF0aW9ucyBcXG4nICsgY2hhbGsuY3lhbihsb2cuam9pbignXFxuJykpKSk7XG4gICAgICB9KS5jYXRjaChleGl0KTtcbiAgICB9KTtcblxuICBjb21tYW5kZXJcbiAgICAuY29tbWFuZCgnbWlncmF0ZTpyb2xsYmFjaycpXG4gICAgLmRlc2NyaXB0aW9uKCcgICAgICAgIFJvbGxiYWNrIHRoZSBsYXN0IHNldCBvZiBtaWdyYXRpb25zIHBlcmZvcm1lZC4nKVxuICAgIC5hY3Rpb24oZnVuY3Rpb24oKSB7XG4gICAgICBwZW5kaW5nID0gaW5pdEtuZXgoZW52KS5taWdyYXRlLnJvbGxiYWNrKCkuc3ByZWFkKGZ1bmN0aW9uKGJhdGNoTm8sIGxvZykge1xuICAgICAgICBpZiAobG9nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHN1Y2Nlc3MoY2hhbGsuY3lhbignQWxyZWFkeSBhdCB0aGUgYmFzZSBtaWdyYXRpb24nKSk7XG4gICAgICAgIH1cbiAgICAgICAgc3VjY2VzcyhjaGFsay5ncmVlbignQmF0Y2ggJyArIGJhdGNoTm8gKyAnIHJvbGxlZCBiYWNrOiAnICsgbG9nLmxlbmd0aCArICcgbWlncmF0aW9ucyBcXG4nKSArIGNoYWxrLmN5YW4obG9nLmpvaW4oJ1xcbicpKSk7XG4gICAgICB9KS5jYXRjaChleGl0KTtcbiAgICB9KTtcblxuICBjb21tYW5kZXJcbiAgICAuY29tbWFuZCgnbWlncmF0ZTpjdXJyZW50VmVyc2lvbicpXG4gICAgLmRlc2NyaXB0aW9uKCcgICAgICAgVmlldyB0aGUgY3VycmVudCB2ZXJzaW9uIGZvciB0aGUgbWlncmF0aW9uLicpXG4gICAgLmFjdGlvbihmdW5jdGlvbiAoKSB7XG4gICAgICBwZW5kaW5nID0gaW5pdEtuZXgoZW52KS5taWdyYXRlLmN1cnJlbnRWZXJzaW9uKCkudGhlbihmdW5jdGlvbih2ZXJzaW9uKSB7XG4gICAgICAgIHN1Y2Nlc3MoY2hhbGsuZ3JlZW4oJ0N1cnJlbnQgVmVyc2lvbjogJykgKyBjaGFsay5ibHVlKHZlcnNpb24pKTtcbiAgICAgIH0pLmNhdGNoKGV4aXQpO1xuICAgIH0pO1xuXG4gIGNvbW1hbmRlclxuICAgIC5jb21tYW5kKCdzZWVkOm1ha2UgPG5hbWU+JylcbiAgICAuZGVzY3JpcHRpb24oJyAgICAgICBDcmVhdGUgYSBuYW1lZCBzZWVkIGZpbGUuJylcbiAgICAub3B0aW9uKCcteCBbJyArIGZpbGV0eXBlcy5qb2luKCd8JykgKyAnXScsICdTcGVjaWZ5IHRoZSBzdHViIGV4dGVuc2lvbiAoZGVmYXVsdCBqcyknKVxuICAgIC5hY3Rpb24oZnVuY3Rpb24obmFtZSkge1xuICAgICAgdmFyIGV4dCA9IChhcmd2LnggfHwgZW52LmNvbmZpZ1BhdGguc3BsaXQoJy4nKS5wb3AoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHBlbmRpbmcgPSBpbml0S25leChlbnYpLnNlZWQubWFrZShuYW1lLCB7ZXh0ZW5zaW9uOiBleHR9KS50aGVuKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgICAgc3VjY2VzcyhjaGFsay5ncmVlbignQ3JlYXRlZCBzZWVkIGZpbGU6ICcgKyBuYW1lKSk7XG4gICAgICB9KS5jYXRjaChleGl0KTtcbiAgICB9KTtcblxuICBjb21tYW5kZXJcbiAgICAuY29tbWFuZCgnc2VlZDpydW4nKVxuICAgIC5kZXNjcmlwdGlvbignICAgICAgIFJ1biBzZWVkIGZpbGVzLicpXG4gICAgLmFjdGlvbihmdW5jdGlvbigpIHtcbiAgICAgIHBlbmRpbmcgPSBpbml0S25leChlbnYpLnNlZWQucnVuKCkuc3ByZWFkKGZ1bmN0aW9uKGxvZykge1xuICAgICAgICBpZiAobG9nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHN1Y2Nlc3MoY2hhbGsuY3lhbignTm8gc2VlZCBmaWxlcyBleGlzdCcpKTtcbiAgICAgICAgfVxuICAgICAgICBzdWNjZXNzKGNoYWxrLmdyZWVuKCdSYW4gJyArIGxvZy5sZW5ndGggKyAnIHNlZWQgZmlsZXMgXFxuJyArIGNoYWxrLmN5YW4obG9nLmpvaW4oJ1xcbicpKSkpO1xuICAgICAgfSkuY2F0Y2goZXhpdCk7XG4gICAgfSk7XG5cbiAgY29tbWFuZGVyLnBhcnNlKHByb2Nlc3MuYXJndik7XG5cbiAgUHJvbWlzZS5yZXNvbHZlKHBlbmRpbmcpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgY29tbWFuZGVyLmhlbHAoKTtcbiAgfSk7XG59XG5cbnZhciBjbGkgPSBuZXcgTGlmdG9mZih7XG4gIG5hbWU6ICdrbmV4JyxcbiAgZXh0ZW5zaW9uczogaW50ZXJwcmV0LmpzVmFyaWFudHMsXG4gIHY4ZmxhZ3M6IHJlcXVpcmUoJ3Y4ZmxhZ3MnKVxufSk7XG5cbmNsaS5vbigncmVxdWlyZScsIGZ1bmN0aW9uKG5hbWUpIHtcbiAgY29uc29sZS5sb2coJ1JlcXVpcmluZyBleHRlcm5hbCBtb2R1bGUnLCBjaGFsay5tYWdlbnRhKG5hbWUpKTtcbn0pO1xuXG5jbGkub24oJ3JlcXVpcmVGYWlsJywgZnVuY3Rpb24obmFtZSkge1xuICBjb25zb2xlLmxvZyhjaGFsay5yZWQoJ0ZhaWxlZCB0byBsb2FkIGV4dGVybmFsIG1vZHVsZScpLCBjaGFsay5tYWdlbnRhKG5hbWUpKTtcbn0pO1xuXG5jbGkubGF1bmNoKHtcbiAgY3dkOiBhcmd2LmN3ZCxcbiAgY29uZmlnUGF0aDogYXJndi5rbmV4ZmlsZSxcbiAgcmVxdWlyZTogYXJndi5yZXF1aXJlLFxuICBjb21wbGV0aW9uOiBhcmd2LmNvbXBsZXRpb25cbn0sIGludm9rZSk7XG4iXX0=