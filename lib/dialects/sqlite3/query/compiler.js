
// SQLite3 Query Builder & Compiler

'use strict';

var _ = require('lodash');
var inherits = require('inherits');
var QueryCompiler = require('../../../query/compiler');
var assign = require('lodash/object/assign');

function QueryCompiler_SQLite3(client, builder) {
  QueryCompiler.call(this, client, builder);
}
inherits(QueryCompiler_SQLite3, QueryCompiler);

assign(QueryCompiler_SQLite3.prototype, {

  // The locks are not applicable in SQLite3
  forShare: emptyStr,

  forUpdate: emptyStr,

  // SQLite requires us to build the multi-row insert as a listing of select with
  // unions joining them together. So we'll build out this list of columns and
  // then join them all together with select unions to complete the queries.
  insert: function insert() {
    var insertValues = this.single.insert || [];
    var sql = 'insert into ' + this.tableName + ' ';

    if (Array.isArray(insertValues)) {
      if (insertValues.length === 0) {
        return '';
      } else if (insertValues.length === 1 && insertValues[0] && _.isEmpty(insertValues[0])) {
        return sql + this._emptyInsertValue;
      }
    } else if (typeof insertValues === 'object' && _.isEmpty(insertValues)) {
      return sql + this._emptyInsertValue;
    }

    var insertData = this._prepInsert(insertValues);

    if (_.isString(insertData)) {
      return sql + insertData;
    }

    if (insertData.columns.length === 0) {
      return '';
    }

    sql += '(' + this.formatter.columnize(insertData.columns) + ')';

    if (insertData.values.length === 1) {
      return sql + ' values (' + this.formatter.parameterize(insertData.values[0]) + ')';
    }

    var blocks = [];
    var i = -1;
    while (++i < insertData.values.length) {
      var i2 = -1,
          block = blocks[i] = [];
      var current = insertData.values[i];
      while (++i2 < insertData.columns.length) {
        block.push(this.formatter.alias(this.formatter.parameter(current[i2]), this.formatter.wrap(insertData.columns[i2])));
      }
      blocks[i] = block.join(', ');
    }
    return sql + ' select ' + blocks.join(' union all select ');
  },

  // Compile a truncate table statement into SQL.
  truncate: function truncate() {
    var table = this.tableName;
    return {
      sql: 'delete from ' + table,
      output: function output() {
        return this.query({ sql: 'delete from sqlite_sequence where name = ' + table })['catch'](function () {});
      }
    };
  },

  // Compiles a `columnInfo` query
  columnInfo: function columnInfo() {
    var column = this.single.columnInfo;
    return {
      sql: 'PRAGMA table_info(' + this.single.table + ')',
      output: function output(resp) {
        var maxLengthRegex = /.*\((\d+)\)/;
        var out = _.reduce(resp, function (columns, val) {
          var type = val.type;
          var maxLength = (maxLength = type.match(maxLengthRegex)) && maxLength[1];
          type = maxLength ? type.split('(')[0] : type;
          columns[val.name] = {
            type: type.toLowerCase(),
            maxLength: maxLength,
            nullable: !val.notnull,
            defaultValue: val.dflt_value
          };
          return columns;
        }, {});
        return column && out[column] || out;
      }
    };
  },

  limit: function limit() {
    var noLimit = !this.single.limit && this.single.limit !== 0;
    if (noLimit && !this.single.offset) return '';

    // Workaround for offset only,
    // see http://stackoverflow.com/questions/10491492/sqllite-with-skip-offset-only-not-limit
    return 'limit ' + this.formatter.parameter(noLimit ? -1 : this.single.limit);
  }

});

function emptyStr() {
  return '';
}

module.exports = QueryCompiler_SQLite3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9zcWxpdGUzL3F1ZXJ5L2NvbXBpbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBR0EsSUFBSSxDQUFDLEdBQWUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ3JDLElBQUksUUFBUSxHQUFRLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUN2QyxJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQTtBQUN0RCxJQUFJLE1BQU0sR0FBVSxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7QUFFcEQsU0FBUyxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFO0FBQzlDLGVBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtDQUMxQztBQUNELFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxhQUFhLENBQUMsQ0FBQTs7QUFFOUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLFNBQVMsRUFBRTs7O0FBR3RDLFVBQVEsRUFBRyxRQUFROztBQUVuQixXQUFTLEVBQUUsUUFBUTs7Ozs7QUFLbkIsUUFBTSxFQUFFLGtCQUFXO0FBQ2pCLFFBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQTtBQUMzQyxRQUFJLEdBQUcsR0FBRyxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUE7O0FBRS9DLFFBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsRUFBRTtBQUMvQixVQUFJLFlBQVksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO0FBQzdCLGVBQU8sRUFBRSxDQUFBO09BQ1YsTUFDSSxJQUFJLFlBQVksQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FB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RixDQUFDLENBQUE7O0FBRUYsU0FBUyxRQUFRLEdBQUc7QUFDbEIsU0FBTyxFQUFFLENBQUE7Q0FDVjs7QUFHRCxNQUFNLENBQUMsT0FBTyxHQUFHLHFCQUFxQixDQUFBIiwiZmlsZSI6ImNvbXBpbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBTUUxpdGUzIFF1ZXJ5IEJ1aWxkZXIgJiBDb21waWxlclxuXG52YXIgXyAgICAgICAgICAgICA9IHJlcXVpcmUoJ2xvZGFzaCcpXG52YXIgaW5oZXJpdHMgICAgICA9IHJlcXVpcmUoJ2luaGVyaXRzJylcbnZhciBRdWVyeUNvbXBpbGVyID0gcmVxdWlyZSgnLi4vLi4vLi4vcXVlcnkvY29tcGlsZXInKVxudmFyIGFzc2lnbiAgICAgICAgPSByZXF1aXJlKCdsb2Rhc2gvb2JqZWN0L2Fzc2lnbicpO1xuXG5mdW5jdGlvbiBRdWVyeUNvbXBpbGVyX1NRTGl0ZTMoY2xpZW50LCBidWlsZGVyKSB7XG4gIFF1ZXJ5Q29tcGlsZXIuY2FsbCh0aGlzLCBjbGllbnQsIGJ1aWxkZXIpXG59XG5pbmhlcml0cyhRdWVyeUNvbXBpbGVyX1NRTGl0ZTMsIFF1ZXJ5Q29tcGlsZXIpXG5cbmFzc2lnbihRdWVyeUNvbXBpbGVyX1NRTGl0ZTMucHJvdG90eXBlLCB7XG5cbiAgLy8gVGhlIGxvY2tzIGFyZSBub3QgYXBwbGljYWJsZSBpbiBTUUxpdGUzXG4gIGZvclNoYXJlOiAgZW1wdHlTdHIsXG4gIFxuICBmb3JVcGRhdGU6IGVtcHR5U3RyLFxuXG4gIC8vIFNRTGl0ZSByZXF1aXJlcyB1cyB0byBidWlsZCB0aGUgbXVsdGktcm93IGluc2VydCBhcyBhIGxpc3Rpbmcgb2Ygc2VsZWN0IHdpdGhcbiAgLy8gdW5pb25zIGpvaW5pbmcgdGhlbSB0b2dldGhlci4gU28gd2UnbGwgYnVpbGQgb3V0IHRoaXMgbGlzdCBvZiBjb2x1bW5zIGFuZFxuICAvLyB0aGVuIGpvaW4gdGhlbSBhbGwgdG9nZXRoZXIgd2l0aCBzZWxlY3QgdW5pb25zIHRvIGNvbXBsZXRlIHRoZSBxdWVyaWVzLlxuICBpbnNlcnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbnNlcnRWYWx1ZXMgPSB0aGlzLnNpbmdsZS5pbnNlcnQgfHwgW11cbiAgICB2YXIgc3FsID0gJ2luc2VydCBpbnRvICcgKyB0aGlzLnRhYmxlTmFtZSArICcgJ1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoaW5zZXJ0VmFsdWVzKSkge1xuICAgICAgaWYgKGluc2VydFZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuICcnXG4gICAgICB9XG4gICAgICBlbHNlIGlmIChpbnNlcnRWYWx1ZXMubGVuZ3RoID09PSAxICYmIGluc2VydFZhbHVlc1swXSAmJiBfLmlzRW1wdHkoaW5zZXJ0VmFsdWVzWzBdKSkge1xuICAgICAgICByZXR1cm4gc3FsICsgdGhpcy5fZW1wdHlJbnNlcnRWYWx1ZVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGluc2VydFZhbHVlcyA9PT0gJ29iamVjdCcgJiYgXy5pc0VtcHR5KGluc2VydFZhbHVlcykpIHtcbiAgICAgIHJldHVybiBzcWwgKyB0aGlzLl9lbXB0eUluc2VydFZhbHVlXG4gICAgfVxuXG4gICAgdmFyIGluc2VydERhdGEgPSB0aGlzLl9wcmVwSW5zZXJ0KGluc2VydFZhbHVlcylcbiAgICBcbiAgICBpZiAoXy5pc1N0cmluZyhpbnNlcnREYXRhKSkge1xuICAgICAgcmV0dXJuIHNxbCArIGluc2VydERhdGFcbiAgICB9XG4gICAgXG4gICAgaWYgKGluc2VydERhdGEuY29sdW1ucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBzcWwgKz0gJygnICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGluc2VydERhdGEuY29sdW1ucykgKyAnKSdcbiAgICBcbiAgICBpZiAoaW5zZXJ0RGF0YS52YWx1ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXR1cm4gc3FsICsgJyB2YWx1ZXMgKCcgKyB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXJpemUoaW5zZXJ0RGF0YS52YWx1ZXNbMF0pICsgJyknXG4gICAgfVxuICAgIFxuICAgIHZhciBibG9ja3MgPSBbXVxuICAgIHZhciBpICAgICAgPSAtMVxuICAgIHdoaWxlICgrK2kgPCBpbnNlcnREYXRhLnZhbHVlcy5sZW5ndGgpIHtcbiAgICAgIHZhciBpMiA9IC0xLCBibG9jayA9IGJsb2Nrc1tpXSA9IFtdXG4gICAgICB2YXIgY3VycmVudCA9IGluc2VydERhdGEudmFsdWVzW2ldXG4gICAgICB3aGlsZSAoKytpMiA8IGluc2VydERhdGEuY29sdW1ucy5sZW5ndGgpIHtcbiAgICAgICAgYmxvY2sucHVzaCh0aGlzLmZvcm1hdHRlci5hbGlhcyhcbiAgICAgICAgICB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXIoY3VycmVudFtpMl0pLFxuICAgICAgICAgIHRoaXMuZm9ybWF0dGVyLndyYXAoaW5zZXJ0RGF0YS5jb2x1bW5zW2kyXSlcbiAgICAgICAgKSlcbiAgICAgIH1cbiAgICAgIGJsb2Nrc1tpXSA9IGJsb2NrLmpvaW4oJywgJylcbiAgICB9XG4gICAgcmV0dXJuIHNxbCArICcgc2VsZWN0ICcgKyBibG9ja3Muam9pbignIHVuaW9uIGFsbCBzZWxlY3QgJylcbiAgfSxcblxuICAvLyBDb21waWxlIGEgdHJ1bmNhdGUgdGFibGUgc3RhdGVtZW50IGludG8gU1FMLlxuICB0cnVuY2F0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRhYmxlID0gdGhpcy50YWJsZU5hbWVcbiAgICByZXR1cm4ge1xuICAgICAgc3FsOiAnZGVsZXRlIGZyb20gJyArIHRhYmxlLFxuICAgICAgb3V0cHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnkoe3NxbDogJ2RlbGV0ZSBmcm9tIHNxbGl0ZV9zZXF1ZW5jZSB3aGVyZSBuYW1lID0gJyArIHRhYmxlfSkuY2F0Y2goZnVuY3Rpb24oKSB7fSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgLy8gQ29tcGlsZXMgYSBgY29sdW1uSW5mb2AgcXVlcnlcbiAgY29sdW1uSW5mbzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNvbHVtbiA9IHRoaXMuc2luZ2xlLmNvbHVtbkluZm9cbiAgICByZXR1cm4ge1xuICAgICAgc3FsOiAnUFJBR01BIHRhYmxlX2luZm8oJyArIHRoaXMuc2luZ2xlLnRhYmxlICsnKScsXG4gICAgICBvdXRwdXQ6IGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgdmFyIG1heExlbmd0aFJlZ2V4ID0gLy4qXFwoKFxcZCspXFwpL1xuICAgICAgICB2YXIgb3V0ID0gXy5yZWR1Y2UocmVzcCwgZnVuY3Rpb24gKGNvbHVtbnMsIHZhbCkge1xuICAgICAgICAgIHZhciB0eXBlID0gdmFsLnR5cGVcbiAgICAgICAgICB2YXIgbWF4TGVuZ3RoID0gKG1heExlbmd0aCA9IHR5cGUubWF0Y2gobWF4TGVuZ3RoUmVnZXgpKSAmJiBtYXhMZW5ndGhbMV1cbiAgICAgICAgICB0eXBlID0gbWF4TGVuZ3RoID8gdHlwZS5zcGxpdCgnKCcpWzBdIDogdHlwZVxuICAgICAgICAgIGNvbHVtbnNbdmFsLm5hbWVdID0ge1xuICAgICAgICAgICAgdHlwZTogdHlwZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbWF4TGVuZ3RoOiBtYXhMZW5ndGgsXG4gICAgICAgICAgICBudWxsYWJsZTogIXZhbC5ub3RudWxsLFxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiB2YWwuZGZsdF92YWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY29sdW1uc1xuICAgICAgICB9LCB7fSlcbiAgICAgICAgcmV0dXJuIGNvbHVtbiAmJiBvdXRbY29sdW1uXSB8fCBvdXRcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgbGltaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBub0xpbWl0ID0gIXRoaXMuc2luZ2xlLmxpbWl0ICYmIHRoaXMuc2luZ2xlLmxpbWl0ICE9PSAwXG4gICAgaWYgKG5vTGltaXQgJiYgIXRoaXMuc2luZ2xlLm9mZnNldCkgcmV0dXJuICcnXG4gIFxuICAgIC8vIFdvcmthcm91bmQgZm9yIG9mZnNldCBvbmx5LCBcbiAgICAvLyBzZWUgaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDQ5MTQ5Mi9zcWxsaXRlLXdpdGgtc2tpcC1vZmZzZXQtb25seS1ub3QtbGltaXRcbiAgICByZXR1cm4gJ2xpbWl0ICcgKyB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXIobm9MaW1pdCA/IC0xIDogdGhpcy5zaW5nbGUubGltaXQpXG4gIH1cblxufSlcblxuZnVuY3Rpb24gZW1wdHlTdHIoKSB7XG4gIHJldHVybiAnJ1xufVxuXG5cbm1vZHVsZS5leHBvcnRzID0gUXVlcnlDb21waWxlcl9TUUxpdGUzXG4iXX0=