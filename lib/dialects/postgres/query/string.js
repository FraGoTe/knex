'use strict';

var _ = require('lodash');
var helpers = require('../../../helpers');
var SqlString = _.extend(exports, require('../../../query/string'));

SqlString.escape = function (val, timeZone) {
  if (val == null) {
    return 'NULL';
  }

  switch (typeof val) {
    case 'boolean':
      return val ? 'true' : 'false';
    case 'number':
      return val + '';
  }

  if (val instanceof Date) {
    val = SqlString.dateToString(val, timeZone || 'local');
  }

  if (Buffer.isBuffer(val)) {
    return SqlString.bufferToString(val);
  }

  if (Array.isArray(val)) {
    return SqlString.arrayToList(val, timeZone);
  }

  if (typeof val === 'object') {
    try {
      val = JSON.stringify(val);
    } catch (e) {
      helpers.warn(e);
      val = val + '';
    }
  }

  val = val.replace(/[\0\n\r\b\t\\\'\x1a]/g, function (s) {
    switch (s) {
      case "\0":
        return "\\0";
      case "\n":
        return "\\n";
      case "\r":
        return "\\r";
      case "\b":
        return "\\b";
      case "\t":
        return "\\t";
      case "\x1a":
        return "\\Z";
      case "\'":
        return "''";
      default:
        return "\\" + s;
    }
  });
  return "'" + val + "'";
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9wb3N0Z3Jlcy9xdWVyeS9zdHJpbmcuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFBOztBQUVaLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMxQixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUMxQyxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDOztBQUVwRSxTQUFTLENBQUMsTUFBTSxHQUFHLFVBQVMsR0FBRyxFQUFFLFFBQVEsRUFBRTtBQUN6QyxNQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7QUFDZixXQUFPLE1BQU0sQ0FBQztHQUNmOztBQUVELFVBQVEsT0FBTyxHQUFHO0FBQ2hCLFNBQUssU0FBUztBQUFFLGFBQU8sQUFBQyxHQUFHLEdBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQztBQUFBLEFBQ2hELFNBQUssUUFBUTtBQUFFLGFBQU8sR0FBRyxHQUFDLEVBQUUsQ0FBQztBQUFBLEdBQzlCOztBQUVELE1BQUksR0FBRyxZQUFZLElBQUksRUFBRTtBQUN2QixPQUFHLEdBQUcsU0FBUyxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsUUFBUSxJQUFJLE9BQU8sQ0FBQyxDQUFDO0dBQ3hEOztBQUVELE1BQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtBQUN4QixXQUFPLFNBQVMsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7R0FDdEM7O0FBRUQsTUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ3RCLFdBQU8sU0FBUyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7R0FDN0M7O0FBRUQsTUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7QUFDM0IsUUFBSTtBQUNGLFNBQUcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0tBQzFCLENBQUMsT0FBTyxDQUFDLEVBQUU7QUFDVixhQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ2YsU0FBRyxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUE7S0FDZjtHQUNGOztBQUVELEtBQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLHVCQUF1QixFQUFFLFVBQVMsQ0FBQyxFQUFFO0FBQ3JELFlBQU8sQ0FBQztBQUNOLFdBQUssSUFBSTtBQUFFLGVBQU8sS0FBSyxDQUFDO0FBQUEsQUFDeEIsV0FBSyxJQUFJO0FBQUUsZUFBTyxLQUFLLENBQUM7QUFBQSxBQUN4QixXQUFLLElBQUk7QUFBRSxlQUFPLEtBQUssQ0FBQztBQUFBLEFBQ3hCLFdBQUssSUFBSTtBQUFFLGVBQU8sS0FBSyxDQUFDO0FBQUEsQUFDeEIsV0FBSyxJQUFJO0FBQUUsZUFBTyxLQUFLLENBQUM7QUFBQSxBQUN4QixXQUFLLE1BQU07QUFBRSxlQUFPLEtBQUssQ0FBQztBQUFBLEFBQzFCLFdBQUssSUFBSTtBQUFFLGVBQU8sSUFBSSxDQUFDO0FBQUEsQUFDdkI7QUFBUyxlQUFPLElBQUksR0FBQyxDQUFDLENBQUM7QUFBQSxLQUN4QjtHQUNGLENBQUMsQ0FBQztBQUNILFNBQU8sR0FBRyxHQUFDLEdBQUcsR0FBQyxHQUFHLENBQUM7Q0FDcEIsQ0FBQyIsImZpbGUiOiJzdHJpbmcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxudmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBoZWxwZXJzID0gcmVxdWlyZSgnLi4vLi4vLi4vaGVscGVycycpO1xudmFyIFNxbFN0cmluZyA9IF8uZXh0ZW5kKGV4cG9ydHMsIHJlcXVpcmUoJy4uLy4uLy4uL3F1ZXJ5L3N0cmluZycpKTtcblxuU3FsU3RyaW5nLmVzY2FwZSA9IGZ1bmN0aW9uKHZhbCwgdGltZVpvbmUpIHtcbiAgaWYgKHZhbCA9PSBudWxsKSB7XG4gICAgcmV0dXJuICdOVUxMJztcbiAgfVxuXG4gIHN3aXRjaCAodHlwZW9mIHZhbCkge1xuICAgIGNhc2UgJ2Jvb2xlYW4nOiByZXR1cm4gKHZhbCkgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICAgIGNhc2UgJ251bWJlcic6IHJldHVybiB2YWwrJyc7XG4gIH1cblxuICBpZiAodmFsIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgIHZhbCA9IFNxbFN0cmluZy5kYXRlVG9TdHJpbmcodmFsLCB0aW1lWm9uZSB8fCAnbG9jYWwnKTtcbiAgfVxuXG4gIGlmIChCdWZmZXIuaXNCdWZmZXIodmFsKSkge1xuICAgIHJldHVybiBTcWxTdHJpbmcuYnVmZmVyVG9TdHJpbmcodmFsKTtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHtcbiAgICByZXR1cm4gU3FsU3RyaW5nLmFycmF5VG9MaXN0KHZhbCwgdGltZVpvbmUpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiB2YWwgPT09ICdvYmplY3QnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhbCA9IEpTT04uc3RyaW5naWZ5KHZhbClcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBoZWxwZXJzLndhcm4oZSlcbiAgICAgIHZhbCA9IHZhbCArICcnXG4gICAgfVxuICB9XG5cbiAgdmFsID0gdmFsLnJlcGxhY2UoL1tcXDBcXG5cXHJcXGJcXHRcXFxcXFwnXFx4MWFdL2csIGZ1bmN0aW9uKHMpIHtcbiAgICBzd2l0Y2gocykge1xuICAgICAgY2FzZSBcIlxcMFwiOiByZXR1cm4gXCJcXFxcMFwiO1xuICAgICAgY2FzZSBcIlxcblwiOiByZXR1cm4gXCJcXFxcblwiO1xuICAgICAgY2FzZSBcIlxcclwiOiByZXR1cm4gXCJcXFxcclwiO1xuICAgICAgY2FzZSBcIlxcYlwiOiByZXR1cm4gXCJcXFxcYlwiO1xuICAgICAgY2FzZSBcIlxcdFwiOiByZXR1cm4gXCJcXFxcdFwiO1xuICAgICAgY2FzZSBcIlxceDFhXCI6IHJldHVybiBcIlxcXFxaXCI7XG4gICAgICBjYXNlIFwiXFwnXCI6IHJldHVybiBcIicnXCI7XG4gICAgICBkZWZhdWx0OiByZXR1cm4gXCJcXFxcXCIrcztcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gXCInXCIrdmFsK1wiJ1wiO1xufTtcbiJdfQ==