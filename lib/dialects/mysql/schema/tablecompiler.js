
// MySQL Table Builder & Compiler
// -------
'use strict';

var inherits = require('inherits');
var TableCompiler = require('../../../schema/tablecompiler');
var helpers = require('../../../helpers');
var Promise = require('../../../promise');
var assign = require('lodash/object/assign');

// Table Compiler
// ------

function TableCompiler_MySQL() {
  TableCompiler.apply(this, arguments);
}
inherits(TableCompiler_MySQL, TableCompiler);

assign(TableCompiler_MySQL.prototype, {

  createQuery: function createQuery(columns, ifNot) {
    var createStatement = ifNot ? 'create table if not exists ' : 'create table ';
    var client = this.client,
        conn = {},
        sql = createStatement + this.tableName() + ' (' + columns.sql.join(', ') + ')';

    // Check if the connection settings are set.
    if (client.connectionSettings) {
      conn = client.connectionSettings;
    }

    var charset = this.single.charset || conn.charset || '';
    var collation = this.single.collate || conn.collate || '';
    var engine = this.single.engine || '';

    // var conn = builder.client.connectionSettings;
    if (charset) sql += ' default character set ' + charset;
    if (collation) sql += ' collate ' + collation;
    if (engine) sql += ' engine = ' + engine;

    if (this.single.comment) {
      var comment = this.single.comment || '';
      if (comment.length > 60) helpers.warn('The max length for a table comment is 60 characters');
      sql += " comment = '" + comment + "'";
    }

    this.pushQuery(sql);
  },

  addColumnsPrefix: 'add ',

  dropColumnPrefix: 'drop ',

  // Compiles the comment on the table.
  comment: function comment(_comment) {
    this.pushQuery('alter table ' + this.tableName() + " comment = '" + _comment + "'");
  },

  changeType: function changeType() {
    // alter table + table + ' modify ' + wrapped + '// type';
  },

  // Renames a column on the table.
  renameColumn: function renameColumn(from, to) {
    var compiler = this;
    var table = this.tableName();
    var wrapped = this.formatter.wrap(from) + ' ' + this.formatter.wrap(to);

    this.pushQuery({
      sql: 'show fields from ' + table + ' where field = ' + this.formatter.parameter(from),
      output: function output(resp) {
        var column = resp[0];
        var runner = this;
        return compiler.getFKRefs(runner).get(0).then(function (refs) {
          return Promise['try'](function () {
            if (!refs.length) {
              return;
            }
            return compiler.dropFKRefs(runner, refs);
          }).then(function () {
            return runner.query({
              sql: 'alter table ' + table + ' change ' + wrapped + ' ' + column.Type
            });
          }).then(function () {
            if (!refs.length) {
              return;
            }
            return compiler.createFKRefs(runner, refs.map(function (ref) {
              if (ref.REFERENCED_COLUMN_NAME === from) {
                ref.REFERENCED_COLUMN_NAME = to;
              }
              if (ref.COLUMN_NAME === from) {
                ref.COLUMN_NAME = to;
              }
              return ref;
            }));
          });
        });
      }
    });
  },

  getFKRefs: function getFKRefs(runner) {
    var formatter = this.client.formatter();
    var sql = 'SELECT KCU.CONSTRAINT_NAME, KCU.TABLE_NAME, KCU.COLUMN_NAME, ' + '       KCU.REFERENCED_TABLE_NAME, KCU.REFERENCED_COLUMN_NAME, ' + '       RC.UPDATE_RULE, RC.DELETE_RULE ' + 'FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KCU ' + 'JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS AS RC ' + '       USING(CONSTRAINT_NAME)' + 'WHERE KCU.REFERENCED_TABLE_NAME = ' + formatter.parameter(this.tableNameRaw) + ' ' + '  AND KCU.CONSTRAINT_SCHEMA = ' + formatter.parameter(this.client.database()) + ' ' + '  AND RC.CONSTRAINT_SCHEMA = ' + formatter.parameter(this.client.database());

    return runner.query({
      sql: sql,
      bindings: formatter.bindings
    });
  },

  dropFKRefs: function dropFKRefs(runner, refs) {
    var formatter = this.client.formatter();

    return Promise.all(refs.map(function (ref) {
      var constraintName = formatter.wrap(ref.CONSTRAINT_NAME);
      var tableName = formatter.wrap(ref.TABLE_NAME);
      return runner.query({
        sql: 'alter table ' + tableName + ' drop foreign key ' + constraintName
      });
    }));
  },
  createFKRefs: function createFKRefs(runner, refs) {
    var formatter = this.client.formatter();

    return Promise.all(refs.map(function (ref) {
      var tableName = formatter.wrap(ref.TABLE_NAME);
      var keyName = formatter.wrap(ref.CONSTRAINT_NAME);
      var column = formatter.columnize(ref.COLUMN_NAME);
      var references = formatter.columnize(ref.REFERENCED_COLUMN_NAME);
      var inTable = formatter.wrap(ref.REFERENCED_TABLE_NAME);
      var onUpdate = ' ON UPDATE ' + ref.UPDATE_RULE;
      var onDelete = ' ON DELETE ' + ref.DELETE_RULE;

      return runner.query({
        sql: 'alter table ' + tableName + ' add constraint ' + keyName + ' ' + 'foreign key (' + column + ') references ' + inTable + ' (' + references + ')' + onUpdate + onDelete
      });
    }));
  },
  index: function index(columns, indexName) {
    indexName = indexName || this._indexCommand('index', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + " add index " + indexName + "(" + this.formatter.columnize(columns) + ")");
  },

  primary: function primary(columns, indexName) {
    indexName = indexName || this._indexCommand('primary', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + " add primary key " + indexName + "(" + this.formatter.columnize(columns) + ")");
  },

  unique: function unique(columns, indexName) {
    indexName = indexName || this._indexCommand('unique', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + " add unique " + indexName + "(" + this.formatter.columnize(columns) + ")");
  },

  // Compile a drop index command.
  dropIndex: function dropIndex(columns, indexName) {
    indexName = indexName || this._indexCommand('index', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + ' drop index ' + indexName);
  },

  // Compile a drop foreign key command.
  dropForeign: function dropForeign(columns, indexName) {
    indexName = indexName || this._indexCommand('foreign', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + ' drop foreign key ' + indexName);
  },

  // Compile a drop primary key command.
  dropPrimary: function dropPrimary() {
    this.pushQuery('alter table ' + this.tableName() + ' drop primary key');
  },

  // Compile a drop unique key command.
  dropUnique: function dropUnique(column, indexName) {
    indexName = indexName || this._indexCommand('unique', this.tableNameRaw, column);
    this.pushQuery('alter table ' + this.tableName() + ' drop index ' + indexName);
  }

});

module.exports = TableCompiler_MySQL;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9teXNxbC9zY2hlbWEvdGFibGVjb21waWxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUdBLElBQUksUUFBUSxHQUFRLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN4QyxJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUM3RCxJQUFJLE9BQU8sR0FBUyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNoRCxJQUFJLE9BQU8sR0FBUyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNoRCxJQUFJLE1BQU0sR0FBVSxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7Ozs7QUFLcEQsU0FBUyxtQkFBbUIsR0FBRztBQUM3QixlQUFhLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztDQUN0QztBQUNELFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxhQUFhLENBQUMsQ0FBQzs7QUFFN0MsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRTs7QUFFcEMsYUFBVyxFQUFFLHFCQUFTLE9BQU8sRUFBRSxLQUFLLEVBQUU7QUFDcEMsUUFBSSxlQUFlLEdBQUcsS0FBSyxHQUFHLDZCQUE2QixHQUFHLGVBQWUsQ0FBQztBQUM5RSxRQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTTtRQUFFLElBQUksR0FBRyxFQUFFO1FBQ2pDLEdBQUcsR0FBRyxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLElBQUksR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7OztBQUdqRixRQUFJLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRTtBQUM3QixVQUFJLEdBQUcsTUFBTSxDQUFDLGtCQUFrQixDQUFDO0tBQ2xDOztBQUVELFFBQUksT0FBTyxHQUFLLElBQUksQ0FBQyxNQUFNLENBQUMs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Q0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDakYsUUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLGNBQWMsR0FBRyxTQUFTLENBQUMsQ0FBQztHQUNoRjs7Q0FFRixDQUFDLENBQUE7O0FBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQyIsImZpbGUiOiJ0YWJsZWNvbXBpbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vLyBNeVNRTCBUYWJsZSBCdWlsZGVyICYgQ29tcGlsZXJcbi8vIC0tLS0tLS1cbnZhciBpbmhlcml0cyAgICAgID0gcmVxdWlyZSgnaW5oZXJpdHMnKTtcbnZhciBUYWJsZUNvbXBpbGVyID0gcmVxdWlyZSgnLi4vLi4vLi4vc2NoZW1hL3RhYmxlY29tcGlsZXInKTtcbnZhciBoZWxwZXJzICAgICAgID0gcmVxdWlyZSgnLi4vLi4vLi4vaGVscGVycycpO1xudmFyIFByb21pc2UgICAgICAgPSByZXF1aXJlKCcuLi8uLi8uLi9wcm9taXNlJyk7XG52YXIgYXNzaWduICAgICAgICA9IHJlcXVpcmUoJ2xvZGFzaC9vYmplY3QvYXNzaWduJyk7XG5cbi8vIFRhYmxlIENvbXBpbGVyXG4vLyAtLS0tLS1cblxuZnVuY3Rpb24gVGFibGVDb21waWxlcl9NeVNRTCgpIHtcbiAgVGFibGVDb21waWxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufVxuaW5oZXJpdHMoVGFibGVDb21waWxlcl9NeVNRTCwgVGFibGVDb21waWxlcik7XG5cbmFzc2lnbihUYWJsZUNvbXBpbGVyX015U1FMLnByb3RvdHlwZSwge1xuXG4gIGNyZWF0ZVF1ZXJ5OiBmdW5jdGlvbihjb2x1bW5zLCBpZk5vdCkge1xuICAgIHZhciBjcmVhdGVTdGF0ZW1lbnQgPSBpZk5vdCA/ICdjcmVhdGUgdGFibGUgaWYgbm90IGV4aXN0cyAnIDogJ2NyZWF0ZSB0YWJsZSAnO1xuICAgIHZhciBjbGllbnQgPSB0aGlzLmNsaWVudCwgY29ubiA9IHt9LCBcbiAgICAgIHNxbCA9IGNyZWF0ZVN0YXRlbWVudCArIHRoaXMudGFibGVOYW1lKCkgKyAnICgnICsgY29sdW1ucy5zcWwuam9pbignLCAnKSArICcpJztcblxuICAgIC8vIENoZWNrIGlmIHRoZSBjb25uZWN0aW9uIHNldHRpbmdzIGFyZSBzZXQuXG4gICAgaWYgKGNsaWVudC5jb25uZWN0aW9uU2V0dGluZ3MpIHtcbiAgICAgIGNvbm4gPSBjbGllbnQuY29ubmVjdGlvblNldHRpbmdzO1xuICAgIH1cblxuICAgIHZhciBjaGFyc2V0ICAgPSB0aGlzLnNpbmdsZS5jaGFyc2V0IHx8IGNvbm4uY2hhcnNldCB8fCAnJztcbiAgICB2YXIgY29sbGF0aW9uID0gdGhpcy5zaW5nbGUuY29sbGF0ZSB8fCBjb25uLmNvbGxhdGUgfHwgJyc7XG4gICAgdmFyIGVuZ2luZSAgICA9IHRoaXMuc2luZ2xlLmVuZ2luZSAgfHwgJyc7XG5cbiAgICAvLyB2YXIgY29ubiA9IGJ1aWxkZXIuY2xpZW50LmNvbm5lY3Rpb25TZXR0aW5ncztcbiAgICBpZiAoY2hhcnNldCkgICBzcWwgKz0gJyBkZWZhdWx0IGNoYXJhY3RlciBzZXQgJyArIGNoYXJzZXQ7XG4gICAgaWYgKGNvbGxhdGlvbikgc3FsICs9ICcgY29sbGF0ZSAnICsgY29sbGF0aW9uO1xuICAgIGlmIChlbmdpbmUpICAgIHNxbCArPSAnIGVuZ2luZSA9ICcgKyBlbmdpbmU7XG5cbiAgICBpZiAodGhpcy5zaW5nbGUuY29tbWVudCkge1xuICAgICAgdmFyIGNvbW1lbnQgPSAodGhpcy5zaW5nbGUuY29tbWVudCB8fCAnJyk7XG4gICAgICBpZiAoY29tbWVudC5sZW5ndGggPiA2MCkgaGVscGVycy53YXJuKCdUaGUgbWF4IGxlbmd0aCBmb3IgYSB0YWJsZSBjb21tZW50IGlzIDYwIGNoYXJhY3RlcnMnKTtcbiAgICAgIHNxbCArPSBcIiBjb21tZW50ID0gJ1wiICsgY29tbWVudCArIFwiJ1wiO1xuICAgIH1cblxuICAgIHRoaXMucHVzaFF1ZXJ5KHNxbCk7XG4gIH0sXG5cbiAgYWRkQ29sdW1uc1ByZWZpeDogJ2FkZCAnLFxuICBcbiAgZHJvcENvbHVtblByZWZpeDogJ2Ryb3AgJyxcblxuICAvLyBDb21waWxlcyB0aGUgY29tbWVudCBvbiB0aGUgdGFibGUuXG4gIGNvbW1lbnQ6IGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICB0aGlzLnB1c2hRdWVyeSgnYWx0ZXIgdGFibGUgJyArIHRoaXMudGFibGVOYW1lKCkgKyBcIiBjb21tZW50ID0gJ1wiICsgY29tbWVudCArIFwiJ1wiKTtcbiAgfSxcblxuICBjaGFuZ2VUeXBlOiBmdW5jdGlvbigpIHtcbiAgICAvLyBhbHRlciB0YWJsZSArIHRhYmxlICsgJyBtb2RpZnkgJyArIHdyYXBwZWQgKyAnLy8gdHlwZSc7XG4gIH0sXG5cbiAgLy8gUmVuYW1lcyBhIGNvbHVtbiBvbiB0aGUgdGFibGUuXG4gIHJlbmFtZUNvbHVtbjogZnVuY3Rpb24oZnJvbSwgdG8pIHtcbiAgICB2YXIgY29tcGlsZXIgPSB0aGlzO1xuICAgIHZhciB0YWJsZSAgICA9IHRoaXMudGFibGVOYW1lKCk7XG4gICAgdmFyIHdyYXBwZWQgID0gdGhpcy5mb3JtYXR0ZXIud3JhcChmcm9tKSArICcgJyArIHRoaXMuZm9ybWF0dGVyLndyYXAodG8pO1xuICAgIFxuICAgIHRoaXMucHVzaFF1ZXJ5KHtcbiAgICAgIHNxbDogJ3Nob3cgZmllbGRzIGZyb20gJyArIHRhYmxlICsgJyB3aGVyZSBmaWVsZCA9ICcgK1xuICAgICAgICB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXIoZnJvbSksXG4gICAgICBvdXRwdXQ6IGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgdmFyIGNvbHVtbiA9IHJlc3BbMF07XG4gICAgICAgIHZhciBydW5uZXIgPSB0aGlzO1xuICAgICAgICByZXR1cm4gY29tcGlsZXIuZ2V0RktSZWZzKHJ1bm5lcikuZ2V0KDApXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlZnMpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnRyeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmICghcmVmcy5sZW5ndGgpIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgIHJldHVybiBjb21waWxlci5kcm9wRktSZWZzKHJ1bm5lciwgcmVmcyk7XG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJ1bm5lci5xdWVyeSh7XG4gICAgICAgICAgICAgICAgc3FsOiAnYWx0ZXIgdGFibGUgJyArIHRhYmxlICsgJyBjaGFuZ2UgJyArIHdyYXBwZWQgKyAnICcgKyBjb2x1bW4uVHlwZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoIXJlZnMubGVuZ3RoKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgICByZXR1cm4gY29tcGlsZXIuY3JlYXRlRktSZWZzKHJ1bm5lciwgcmVmcy5tYXAoZnVuY3Rpb24gKHJlZikge1xuICAgICAgICAgICAgICAgIGlmIChyZWYuUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSA9PT0gZnJvbSkge1xuICAgICAgICAgICAgICAgICAgcmVmLlJFRkVSRU5DRURfQ09MVU1OX05BTUUgPSB0bztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlZi5DT0xVTU5fTkFNRSA9PT0gZnJvbSkge1xuICAgICAgICAgICAgICAgICAgcmVmLkNPTFVNTl9OQU1FID0gdG87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZWY7XG4gICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIGdldEZLUmVmczogZnVuY3Rpb24gKHJ1bm5lcikge1xuICAgIHZhciBmb3JtYXR0ZXIgPSB0aGlzLmNsaWVudC5mb3JtYXR0ZXIoKTtcbiAgICB2YXIgc3FsID0gJ1NFTEVDVCBLQ1UuQ09OU1RSQUlOVF9OQU1FLCBLQ1UuVEFCTEVfTkFNRSwgS0NVLkNPTFVNTl9OQU1FLCAnK1xuICAgICAgICAgICAgICAnICAgICAgIEtDVS5SRUZFUkVOQ0VEX1RBQkxFX05BTUUsIEtDVS5SRUZFUkVOQ0VEX0NPTFVNTl9OQU1FLCAnK1xuICAgICAgICAgICAgICAnICAgICAgIFJDLlVQREFURV9SVUxFLCBSQy5ERUxFVEVfUlVMRSAnK1xuICAgICAgICAgICAgICAnRlJPTSBJTkZPUk1BVElPTl9TQ0hFTUEuS0VZX0NPTFVNTl9VU0FHRSBBUyBLQ1UgJytcbiAgICAgICAgICAgICAgJ0pPSU4gSU5GT1JNQVRJT05fU0NIRU1BLlJFRkVSRU5USUFMX0NPTlNUUkFJTlRTIEFTIFJDICcrXG4gICAgICAgICAgICAgICcgICAgICAgVVNJTkcoQ09OU1RSQUlOVF9OQU1FKScgK1xuICAgICAgICAgICAgICAnV0hFUkUgS0NVLlJFRkVSRU5DRURfVEFCTEVfTkFNRSA9ICcgKyBmb3JtYXR0ZXIucGFyYW1ldGVyKHRoaXMudGFibGVOYW1lUmF3KSArICcgJytcbiAgICAgICAgICAgICAgJyAgQU5EIEtDVS5DT05TVFJBSU5UX1NDSEVNQSA9ICcgKyBmb3JtYXR0ZXIucGFyYW1ldGVyKHRoaXMuY2xpZW50LmRhdGFiYXNlKCkpICsgJyAnK1xuICAgICAgICAgICAgICAnICBBTkQgUkMuQ09OU1RSQUlOVF9TQ0hFTUEgPSAnICsgZm9ybWF0dGVyLnBhcmFtZXRlcih0aGlzLmNsaWVudC5kYXRhYmFzZSgpKTtcblxuICAgIHJldHVybiBydW5uZXIucXVlcnkoe1xuICAgICAgc3FsOiBzcWwsXG4gICAgICBiaW5kaW5nczogZm9ybWF0dGVyLmJpbmRpbmdzXG4gICAgfSk7XG4gIH0sXG5cbiAgZHJvcEZLUmVmczogZnVuY3Rpb24gKHJ1bm5lciwgcmVmcykge1xuICAgIHZhciBmb3JtYXR0ZXIgPSB0aGlzLmNsaWVudC5mb3JtYXR0ZXIoKTtcbiAgICBcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocmVmcy5tYXAoZnVuY3Rpb24gKHJlZikge1xuICAgICAgdmFyIGNvbnN0cmFpbnROYW1lID0gZm9ybWF0dGVyLndyYXAocmVmLkNPTlNUUkFJTlRfTkFNRSk7XG4gICAgICB2YXIgdGFibGVOYW1lICA9IGZvcm1hdHRlci53cmFwKHJlZi5UQUJMRV9OQU1FKTtcbiAgICAgIHJldHVybiBydW5uZXIucXVlcnkoe1xuICAgICAgICBzcWw6ICdhbHRlciB0YWJsZSAnICsgdGFibGVOYW1lICsgJyBkcm9wIGZvcmVpZ24ga2V5ICcgKyBjb25zdHJhaW50TmFtZVxuICAgICAgfSk7XG4gICAgfSkpO1xuICB9LFxuICBjcmVhdGVGS1JlZnM6IGZ1bmN0aW9uIChydW5uZXIsIHJlZnMpIHtcbiAgICB2YXIgZm9ybWF0dGVyID0gdGhpcy5jbGllbnQuZm9ybWF0dGVyKCk7XG4gICAgXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHJlZnMubWFwKGZ1bmN0aW9uIChyZWYpIHtcbiAgICAgIHZhciB0YWJsZU5hbWUgID0gZm9ybWF0dGVyLndyYXAocmVmLlRBQkxFX05BTUUpO1xuICAgICAgdmFyIGtleU5hbWUgICAgPSBmb3JtYXR0ZXIud3JhcChyZWYuQ09OU1RSQUlOVF9OQU1FKTtcbiAgICAgIHZhciBjb2x1bW4gICAgID0gZm9ybWF0dGVyLmNvbHVtbml6ZShyZWYuQ09MVU1OX05BTUUpO1xuICAgICAgdmFyIHJlZmVyZW5jZXMgPSBmb3JtYXR0ZXIuY29sdW1uaXplKHJlZi5SRUZFUkVOQ0VEX0NPTFVNTl9OQU1FKTtcbiAgICAgIHZhciBpblRhYmxlICAgID0gZm9ybWF0dGVyLndyYXAocmVmLlJFRkVSRU5DRURfVEFCTEVfTkFNRSk7XG4gICAgICB2YXIgb25VcGRhdGUgICA9ICcgT04gVVBEQVRFICcgKyByZWYuVVBEQVRFX1JVTEU7XG4gICAgICB2YXIgb25EZWxldGUgICA9ICcgT04gREVMRVRFICcgKyByZWYuREVMRVRFX1JVTEU7XG4gICAgICBcbiAgICAgIHJldHVybiBydW5uZXIucXVlcnkoe1xuICAgICAgICBzcWw6ICdhbHRlciB0YWJsZSAnICsgdGFibGVOYW1lICsgJyBhZGQgY29uc3RyYWludCAnICsga2V5TmFtZSArICcgJyArIFxuICAgICAgICAgICdmb3JlaWduIGtleSAoJyArIGNvbHVtbiArICcpIHJlZmVyZW5jZXMgJyArIGluVGFibGUgKyAnICgnICsgcmVmZXJlbmNlcyArICcpJyArIG9uVXBkYXRlICsgb25EZWxldGVcbiAgICAgIH0pO1xuICAgIH0pKTtcbiAgfSxcbiAgaW5kZXg6IGZ1bmN0aW9uKGNvbHVtbnMsIGluZGV4TmFtZSkge1xuICAgIGluZGV4TmFtZSA9IGluZGV4TmFtZSB8fCB0aGlzLl9pbmRleENvbW1hbmQoJ2luZGV4JywgdGhpcy50YWJsZU5hbWVSYXcsIGNvbHVtbnMpO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArIFwiIGFkZCBpbmRleCBcIiArIGluZGV4TmFtZSArIFwiKFwiICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgXCIpXCIpO1xuICB9LFxuXG4gIHByaW1hcnk6IGZ1bmN0aW9uKGNvbHVtbnMsIGluZGV4TmFtZSkge1xuICAgIGluZGV4TmFtZSA9IGluZGV4TmFtZSB8fCB0aGlzLl9pbmRleENvbW1hbmQoJ3ByaW1hcnknLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgXCIgYWRkIHByaW1hcnkga2V5IFwiICsgaW5kZXhOYW1lICsgXCIoXCIgKyB0aGlzLmZvcm1hdHRlci5jb2x1bW5pemUoY29sdW1ucykgKyBcIilcIik7XG4gIH0sXG5cbiAgdW5pcXVlOiBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUgfHwgdGhpcy5faW5kZXhDb21tYW5kKCd1bmlxdWUnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgXCIgYWRkIHVuaXF1ZSBcIiArIGluZGV4TmFtZSArIFwiKFwiICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgXCIpXCIpO1xuICB9LFxuXG4gIC8vIENvbXBpbGUgYSBkcm9wIGluZGV4IGNvbW1hbmQuXG4gIGRyb3BJbmRleDogZnVuY3Rpb24oY29sdW1ucywgaW5kZXhOYW1lKSB7XG4gICAgaW5kZXhOYW1lID0gaW5kZXhOYW1lIHx8IHRoaXMuX2luZGV4Q29tbWFuZCgnaW5kZXgnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgJyBkcm9wIGluZGV4ICcgKyBpbmRleE5hbWUpO1xuICB9LFxuXG4gIC8vIENvbXBpbGUgYSBkcm9wIGZvcmVpZ24ga2V5IGNvbW1hbmQuXG4gIGRyb3BGb3JlaWduOiBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUgfHwgdGhpcy5faW5kZXhDb21tYW5kKCdmb3JlaWduJywgdGhpcy50YWJsZU5hbWVSYXcsIGNvbHVtbnMpO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArICcgZHJvcCBmb3JlaWduIGtleSAnICsgaW5kZXhOYW1lKTtcbiAgfSxcblxuICAvLyBDb21waWxlIGEgZHJvcCBwcmltYXJ5IGtleSBjb21tYW5kLlxuICBkcm9wUHJpbWFyeTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgJyBkcm9wIHByaW1hcnkga2V5Jyk7XG4gIH0sXG5cbiAgLy8gQ29tcGlsZSBhIGRyb3AgdW5pcXVlIGtleSBjb21tYW5kLlxuICBkcm9wVW5pcXVlOiBmdW5jdGlvbihjb2x1bW4sIGluZGV4TmFtZSkge1xuICAgIGluZGV4TmFtZSA9IGluZGV4TmFtZSB8fCB0aGlzLl9pbmRleENvbW1hbmQoJ3VuaXF1ZScsIHRoaXMudGFibGVOYW1lUmF3LCBjb2x1bW4pO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArICcgZHJvcCBpbmRleCAnICsgaW5kZXhOYW1lKTtcbiAgfVxuXG59KVxuXG5tb2R1bGUuZXhwb3J0cyA9IFRhYmxlQ29tcGlsZXJfTXlTUUw7XG4iXX0=