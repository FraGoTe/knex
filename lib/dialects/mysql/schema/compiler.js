
// MySQL Schema Compiler
// -------
'use strict';

var inherits = require('inherits');
var SchemaCompiler = require('../../../schema/compiler');
var assign = require('lodash/object/assign');

function SchemaCompiler_MySQL(client, builder) {
  SchemaCompiler.call(this, client, builder);
}
inherits(SchemaCompiler_MySQL, SchemaCompiler);

assign(SchemaCompiler_MySQL.prototype, {

  // Rename a table on the schema.
  renameTable: function renameTable(tableName, to) {
    this.pushQuery('rename table ' + this.formatter.wrap(tableName) + ' to ' + this.formatter.wrap(to));
  },

  // Check whether a table exists on the query.
  hasTable: function hasTable(tableName) {
    this.pushQuery({
      sql: 'show tables like ' + this.formatter.parameter(tableName),
      output: function output(resp) {
        return resp.length > 0;
      }
    });
  },

  // Check whether a column exists on the schema.
  hasColumn: function hasColumn(tableName, column) {
    this.pushQuery({
      sql: 'show columns from ' + this.formatter.wrap(tableName) + ' like ' + this.formatter.parameter(column),
      output: function output(resp) {
        return resp.length > 0;
      }
    });
  }

});

module.exports = SchemaCompiler_MySQL;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9teXNxbC9zY2hlbWEvY29tcGlsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFHQSxJQUFJLFFBQVEsR0FBUyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDekMsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDekQsSUFBSSxNQUFNLEdBQVcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7O0FBRXJELFNBQVMsb0JBQW9CLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRTtBQUM3QyxnQkFBYyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFBO0NBQzNDO0FBQ0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLGNBQWMsQ0FBQyxDQUFBOztBQUU5QyxNQUFNLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFOzs7QUFHckMsYUFBVyxFQUFFLHFCQUFTLFNBQVMsRUFBRSxFQUFFLEVBQUU7QUFDbkMsUUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7R0FDckc7OztBQUdELFVBQVEsRUFBRSxrQkFBUyxTQUFTLEVBQUU7QUFDNUIsUUFBSSxDQUFDLFNBQVMsQ0FBQztBQUNiLFNBQUcsRUFBRSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7QUFDOUQsWUFBTSxFQUFFLGdCQUFTLElBQUksRUFBRTtBQUNyQixlQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO09BQ3hCO0tBQ0YsQ0FBQyxDQUFDO0dBQ0o7OztBQUdELFdBQVMsRUFBRSxtQkFBUyxTQUFTLEVBQUUsTUFBTSxFQUFFO0FBQ3JDLFFBQUksQ0FBQyxTQUFTLENBQUM7QUFDYixTQUFHLEVBQUUsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQ3hELFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7QUFDN0MsWUFBTSxFQUFFLGdCQUFTLElBQUksRUFBRTtBQUNyQixlQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO09BQ3hCO0tBQ0YsQ0FBQyxDQUFDO0dBQ0o7O0NBRUYsQ0FBQyxDQUFBOztBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsb0JBQW9CLENBQUMiLCJmaWxlIjoiY29tcGlsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8vIE15U1FMIFNjaGVtYSBDb21waWxlclxuLy8gLS0tLS0tLVxudmFyIGluaGVyaXRzICAgICAgID0gcmVxdWlyZSgnaW5oZXJpdHMnKTtcbnZhciBTY2hlbWFDb21waWxlciA9IHJlcXVpcmUoJy4uLy4uLy4uL3NjaGVtYS9jb21waWxlcicpO1xudmFyIGFzc2lnbiAgICAgICAgID0gcmVxdWlyZSgnbG9kYXNoL29iamVjdC9hc3NpZ24nKTtcblxuZnVuY3Rpb24gU2NoZW1hQ29tcGlsZXJfTXlTUUwoY2xpZW50LCBidWlsZGVyKSB7XG4gIFNjaGVtYUNvbXBpbGVyLmNhbGwodGhpcywgY2xpZW50LCBidWlsZGVyKVxufVxuaW5oZXJpdHMoU2NoZW1hQ29tcGlsZXJfTXlTUUwsIFNjaGVtYUNvbXBpbGVyKVxuXG5hc3NpZ24oU2NoZW1hQ29tcGlsZXJfTXlTUUwucHJvdG90eXBlLCB7XG5cbiAgLy8gUmVuYW1lIGEgdGFibGUgb24gdGhlIHNjaGVtYS5cbiAgcmVuYW1lVGFibGU6IGZ1bmN0aW9uKHRhYmxlTmFtZSwgdG8pIHtcbiAgICB0aGlzLnB1c2hRdWVyeSgncmVuYW1lIHRhYmxlICcgKyB0aGlzLmZvcm1hdHRlci53cmFwKHRhYmxlTmFtZSkgKyAnIHRvICcgKyB0aGlzLmZvcm1hdHRlci53cmFwKHRvKSk7XG4gIH0sXG5cbiAgLy8gQ2hlY2sgd2hldGhlciBhIHRhYmxlIGV4aXN0cyBvbiB0aGUgcXVlcnkuXG4gIGhhc1RhYmxlOiBmdW5jdGlvbih0YWJsZU5hbWUpIHtcbiAgICB0aGlzLnB1c2hRdWVyeSh7XG4gICAgICBzcWw6ICdzaG93IHRhYmxlcyBsaWtlICcgKyB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXIodGFibGVOYW1lKSxcbiAgICAgIG91dHB1dDogZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICByZXR1cm4gcmVzcC5sZW5ndGggPiAwO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIC8vIENoZWNrIHdoZXRoZXIgYSBjb2x1bW4gZXhpc3RzIG9uIHRoZSBzY2hlbWEuXG4gIGhhc0NvbHVtbjogZnVuY3Rpb24odGFibGVOYW1lLCBjb2x1bW4pIHtcbiAgICB0aGlzLnB1c2hRdWVyeSh7XG4gICAgICBzcWw6ICdzaG93IGNvbHVtbnMgZnJvbSAnICsgdGhpcy5mb3JtYXR0ZXIud3JhcCh0YWJsZU5hbWUpICtcbiAgICAgICAgJyBsaWtlICcgKyB0aGlzLmZvcm1hdHRlci5wYXJhbWV0ZXIoY29sdW1uKSxcbiAgICAgIG91dHB1dDogZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICByZXR1cm4gcmVzcC5sZW5ndGggPiAwO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gU2NoZW1hQ29tcGlsZXJfTXlTUUw7XG4iXX0=