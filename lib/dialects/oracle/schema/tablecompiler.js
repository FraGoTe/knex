'use strict';

var inherits = require('inherits');
var utils = require('../utils');
var TableCompiler = require('../../../schema/tablecompiler');
var helpers = require('../../../helpers');
var assign = require('lodash/object/assign');

// Table Compiler
// ------

function TableCompiler_Oracle() {
  TableCompiler.apply(this, arguments);
}
inherits(TableCompiler_Oracle, TableCompiler);

assign(TableCompiler_Oracle.prototype, {

  // Compile a rename column command.
  renameColumn: function renameColumn(from, to) {
    return this.pushQuery({
      sql: 'alter table ' + this.tableName() + ' rename column ' + this.formatter.wrap(from) + ' to ' + this.formatter.wrap(to)
    });
  },

  compileAdd: function compileAdd(builder) {
    var table = this.formatter.wrap(builder);
    var columns = this.prefixArray('add column', this.getColumns(builder));
    return this.pushQuery({
      sql: 'alter table ' + table + ' ' + columns.join(', ')
    });
  },

  // Adds the "create" query to the query sequence.
  createQuery: function createQuery(columns, ifNot) {
    var sql = 'create table ' + this.tableName() + ' (' + columns.sql.join(', ') + ')';
    this.pushQuery({
      // catch "name is already used by an existing object" for workaround for "if not exists"
      sql: ifNot ? utils.wrapSqlWithCatch(sql, -955) : sql,
      bindings: columns.bindings
    });
    if (this.single.comment) this.comment(this.single.comment);
  },

  // Compiles the comment on the table.
  comment: function comment(_comment) {
    this.pushQuery('comment on table ' + this.tableName() + ' is ' + "'" + (_comment || '') + "'");
  },

  addColumnsPrefix: 'add ',

  dropColumn: function dropColumn() {
    var columns = helpers.normalizeArr.apply(null, arguments);
    this.pushQuery('alter table ' + this.tableName() + ' drop (' + this.formatter.columnize(columns) + ')');
  },

  changeType: function changeType() {
    // alter table + table + ' modify ' + wrapped + '// type';
  },

  _indexCommand: function _indexCommand(type, tableName, columns) {
    return this.formatter.wrap(utils.generateCombinedName(type, tableName, columns));
  },

  primary: function primary(columns) {
    this.pushQuery('alter table ' + this.tableName() + " add primary key (" + this.formatter.columnize(columns) + ")");
  },

  dropPrimary: function dropPrimary() {
    this.pushQuery('alter table ' + this.tableName() + ' drop primary key');
  },

  index: function index(columns, indexName) {
    indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('index', this.tableNameRaw, columns);
    this.pushQuery('create index ' + indexName + ' on ' + this.tableName() + ' (' + this.formatter.columnize(columns) + ')');
  },

  dropIndex: function dropIndex(columns, indexName) {
    indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('index', this.tableNameRaw, columns);
    this.pushQuery('drop index ' + indexName);
  },

  unique: function unique(columns, indexName) {
    indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('unique', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + ' add constraint ' + indexName + ' unique (' + this.formatter.columnize(columns) + ')');
  },

  dropUnique: function dropUnique(columns, indexName) {
    indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('unique', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + ' drop constraint ' + indexName);
  },

  dropForeign: function dropForeign(columns, indexName) {
    indexName = indexName ? this.formatter.wrap(indexName) : this._indexCommand('foreign', this.tableNameRaw, columns);
    this.pushQuery('alter table ' + this.tableName() + ' drop constraint ' + indexName);
  }

});

module.exports = TableCompiler_Oracle;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kaWFsZWN0cy9vcmFjbGUvc2NoZW1hL3RhYmxlY29tcGlsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxJQUFJLFFBQVEsR0FBUSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDeEMsSUFBSSxLQUFLLEdBQVcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3hDLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBQzdELElBQUksT0FBTyxHQUFTLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hELElBQUksTUFBTSxHQUFVLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDOzs7OztBQUtwRCxTQUFTLG9CQUFvQixHQUFHO0FBQzlCLGVBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0NBQ3RDO0FBQ0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLGFBQWEsQ0FBQyxDQUFDOztBQUU5QyxNQUFNLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFOzs7QUFHckMsY0FBWSxFQUFFLHNCQUFTLElBQUksRUFBRSxFQUFFLEVBQUU7QUFDL0IsV0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0FBQ3BCLFNBQUcsRUFBRSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxHQUFHLGlCQUFpQixHQUN4RCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO0tBQy9ELENBQUMsQ0FBQztHQUNKOztBQUVELFlBQVUsRUFBRSxvQkFBUyxPQUFPLEVBQUU7QUFDNUIsUUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDekMsUUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FB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LEVBQUUsU0FBUyxFQUFFO0FBQ3hDLGFBQVMsR0FBRyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNuSCxRQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsbUJBQW1CLEdBQUcsU0FBUyxDQUFDLENBQUM7R0FDckY7O0NBRUYsQ0FBQyxDQUFBOztBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsb0JBQW9CLENBQUMiLCJmaWxlIjoidGFibGVjb21waWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxudmFyIGluaGVyaXRzICAgICAgPSByZXF1aXJlKCdpbmhlcml0cycpO1xudmFyIHV0aWxzICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIFRhYmxlQ29tcGlsZXIgPSByZXF1aXJlKCcuLi8uLi8uLi9zY2hlbWEvdGFibGVjb21waWxlcicpO1xudmFyIGhlbHBlcnMgICAgICAgPSByZXF1aXJlKCcuLi8uLi8uLi9oZWxwZXJzJyk7XG52YXIgYXNzaWduICAgICAgICA9IHJlcXVpcmUoJ2xvZGFzaC9vYmplY3QvYXNzaWduJyk7XG5cbi8vIFRhYmxlIENvbXBpbGVyXG4vLyAtLS0tLS1cblxuZnVuY3Rpb24gVGFibGVDb21waWxlcl9PcmFjbGUoKSB7XG4gIFRhYmxlQ29tcGlsZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn1cbmluaGVyaXRzKFRhYmxlQ29tcGlsZXJfT3JhY2xlLCBUYWJsZUNvbXBpbGVyKTtcblxuYXNzaWduKFRhYmxlQ29tcGlsZXJfT3JhY2xlLnByb3RvdHlwZSwge1xuXG4gIC8vIENvbXBpbGUgYSByZW5hbWUgY29sdW1uIGNvbW1hbmQuXG4gIHJlbmFtZUNvbHVtbjogZnVuY3Rpb24oZnJvbSwgdG8pIHtcbiAgICByZXR1cm4gdGhpcy5wdXNoUXVlcnkoe1xuICAgICAgc3FsOiAnYWx0ZXIgdGFibGUgJyArIHRoaXMudGFibGVOYW1lKCkgKyAnIHJlbmFtZSBjb2x1bW4gJyArIFxuICAgICAgICB0aGlzLmZvcm1hdHRlci53cmFwKGZyb20pICsgJyB0byAnICsgdGhpcy5mb3JtYXR0ZXIud3JhcCh0bylcbiAgICB9KTtcbiAgfSxcblxuICBjb21waWxlQWRkOiBmdW5jdGlvbihidWlsZGVyKSB7XG4gICAgdmFyIHRhYmxlID0gdGhpcy5mb3JtYXR0ZXIud3JhcChidWlsZGVyKTtcbiAgICB2YXIgY29sdW1ucyA9IHRoaXMucHJlZml4QXJyYXkoJ2FkZCBjb2x1bW4nLCB0aGlzLmdldENvbHVtbnMoYnVpbGRlcikpO1xuICAgIHJldHVybiB0aGlzLnB1c2hRdWVyeSh7XG4gICAgICBzcWw6ICdhbHRlciB0YWJsZSAnICsgdGFibGUgKyAnICcgKyBjb2x1bW5zLmpvaW4oJywgJylcbiAgICB9KTtcbiAgfSxcblxuICAvLyBBZGRzIHRoZSBcImNyZWF0ZVwiIHF1ZXJ5IHRvIHRoZSBxdWVyeSBzZXF1ZW5jZS5cbiAgY3JlYXRlUXVlcnk6IGZ1bmN0aW9uKGNvbHVtbnMsIGlmTm90KSB7XG4gICAgdmFyIHNxbCA9ICdjcmVhdGUgdGFibGUgJyArIHRoaXMudGFibGVOYW1lKCkgKyAnICgnICsgY29sdW1ucy5zcWwuam9pbignLCAnKSArICcpJztcbiAgICB0aGlzLnB1c2hRdWVyeSh7XG4gICAgICAvLyBjYXRjaCBcIm5hbWUgaXMgYWxyZWFkeSB1c2VkIGJ5IGFuIGV4aXN0aW5nIG9iamVjdFwiIGZvciB3b3JrYXJvdW5kIGZvciBcImlmIG5vdCBleGlzdHNcIlxuICAgICAgc3FsOiBpZk5vdCA/IHV0aWxzLndyYXBTcWxXaXRoQ2F0Y2goc3FsLCAtOTU1KSA6IHNxbCxcbiAgICAgIGJpbmRpbmdzOiBjb2x1bW5zLmJpbmRpbmdzXG4gICAgfSk7XG4gICAgaWYgKHRoaXMuc2luZ2xlLmNvbW1lbnQpIHRoaXMuY29tbWVudCh0aGlzLnNpbmdsZS5jb21tZW50KTtcbiAgfSxcblxuICAvLyBDb21waWxlcyB0aGUgY29tbWVudCBvbiB0aGUgdGFibGUuXG4gIGNvbW1lbnQ6IGZ1bmN0aW9uKGNvbW1lbnQpIHtcbiAgICB0aGlzLnB1c2hRdWVyeSgnY29tbWVudCBvbiB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArICcgaXMgJyArIFwiJ1wiICsgKGNvbW1lbnQgfHwgJycpICsgXCInXCIpO1xuICB9LFxuXG4gIGFkZENvbHVtbnNQcmVmaXg6ICdhZGQgJyxcblxuICBkcm9wQ29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY29sdW1ucyA9IGhlbHBlcnMubm9ybWFsaXplQXJyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgJyBkcm9wICgnICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgJyknKTtcbiAgfSxcblxuICBjaGFuZ2VUeXBlOiBmdW5jdGlvbigpIHtcbiAgICAvLyBhbHRlciB0YWJsZSArIHRhYmxlICsgJyBtb2RpZnkgJyArIHdyYXBwZWQgKyAnLy8gdHlwZSc7XG4gIH0sXG5cbiAgX2luZGV4Q29tbWFuZDogZnVuY3Rpb24odHlwZSwgdGFibGVOYW1lLCBjb2x1bW5zKSB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybWF0dGVyLndyYXAodXRpbHMuZ2VuZXJhdGVDb21iaW5lZE5hbWUodHlwZSwgdGFibGVOYW1lLCBjb2x1bW5zKSk7XG4gIH0sXG5cbiAgcHJpbWFyeTogZnVuY3Rpb24oY29sdW1ucykge1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArIFwiIGFkZCBwcmltYXJ5IGtleSAoXCIgKyB0aGlzLmZvcm1hdHRlci5jb2x1bW5pemUoY29sdW1ucykgKyBcIilcIik7XG4gIH0sXG5cbiAgZHJvcFByaW1hcnk6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArICcgZHJvcCBwcmltYXJ5IGtleScpO1xuICB9LFxuXG4gIGluZGV4OiBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGluZGV4TmFtZSkgOiB0aGlzLl9pbmRleENvbW1hbmQoJ2luZGV4JywgdGhpcy50YWJsZU5hbWVSYXcsIGNvbHVtbnMpO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdjcmVhdGUgaW5kZXggJyArIGluZGV4TmFtZSArICcgb24gJyArIHRoaXMudGFibGVOYW1lKCkgK1xuICAgICAgJyAoJyArIHRoaXMuZm9ybWF0dGVyLmNvbHVtbml6ZShjb2x1bW5zKSArICcpJyk7XG4gIH0sXG5cbiAgZHJvcEluZGV4OiBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGluZGV4TmFtZSkgOiB0aGlzLl9pbmRleENvbW1hbmQoJ2luZGV4JywgdGhpcy50YWJsZU5hbWVSYXcsIGNvbHVtbnMpO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdkcm9wIGluZGV4ICcgKyBpbmRleE5hbWUpO1xuICB9LFxuXG4gIHVuaXF1ZTogZnVuY3Rpb24oY29sdW1ucywgaW5kZXhOYW1lKSB7XG4gICAgaW5kZXhOYW1lID0gaW5kZXhOYW1lID8gdGhpcy5mb3JtYXR0ZXIud3JhcChpbmRleE5hbWUpIDogdGhpcy5faW5kZXhDb21tYW5kKCd1bmlxdWUnLCB0aGlzLnRhYmxlTmFtZVJhdywgY29sdW1ucyk7XG4gICAgdGhpcy5wdXNoUXVlcnkoJ2FsdGVyIHRhYmxlICcgKyB0aGlzLnRhYmxlTmFtZSgpICsgJyBhZGQgY29uc3RyYWludCAnICsgaW5kZXhOYW1lICtcbiAgICAgICcgdW5pcXVlICgnICsgdGhpcy5mb3JtYXR0ZXIuY29sdW1uaXplKGNvbHVtbnMpICsgJyknKTtcbiAgfSxcblxuICBkcm9wVW5pcXVlOiBmdW5jdGlvbihjb2x1bW5zLCBpbmRleE5hbWUpIHtcbiAgICBpbmRleE5hbWUgPSBpbmRleE5hbWUgPyB0aGlzLmZvcm1hdHRlci53cmFwKGluZGV4TmFtZSkgOiB0aGlzLl9pbmRleENvbW1hbmQoJ3VuaXF1ZScsIHRoaXMudGFibGVOYW1lUmF3LCBjb2x1bW5zKTtcbiAgICB0aGlzLnB1c2hRdWVyeSgnYWx0ZXIgdGFibGUgJyArIHRoaXMudGFibGVOYW1lKCkgKyAnIGRyb3AgY29uc3RyYWludCAnICsgaW5kZXhOYW1lKTtcbiAgfSxcblxuICBkcm9wRm9yZWlnbjogZnVuY3Rpb24oY29sdW1ucywgaW5kZXhOYW1lKSB7XG4gICAgaW5kZXhOYW1lID0gaW5kZXhOYW1lID8gdGhpcy5mb3JtYXR0ZXIud3JhcChpbmRleE5hbWUpIDogdGhpcy5faW5kZXhDb21tYW5kKCdmb3JlaWduJywgdGhpcy50YWJsZU5hbWVSYXcsIGNvbHVtbnMpO1xuICAgIHRoaXMucHVzaFF1ZXJ5KCdhbHRlciB0YWJsZSAnICsgdGhpcy50YWJsZU5hbWUoKSArICcgZHJvcCBjb25zdHJhaW50ICcgKyBpbmRleE5hbWUpO1xuICB9XG5cbn0pXG5cbm1vZHVsZS5leHBvcnRzID0gVGFibGVDb21waWxlcl9PcmFjbGU7XG4iXX0=